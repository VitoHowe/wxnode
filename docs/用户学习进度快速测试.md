# ç”¨æˆ·å­¦ä¹ è¿›åº¦ - å¿«é€Ÿæµ‹è¯•æŒ‡å—

## âœ… åŠŸèƒ½å·²å®Œæˆ

ç”¨æˆ·å­¦ä¹ è¿›åº¦ç³»ç»Ÿå·²åˆ›å»ºå®Œæˆï¼ŒåŒ…æ‹¬ï¼š
- âœ… æ•°æ®è¡¨: `user_study_progress`
- âœ… Serviceå±‚: `userProgressService.ts`
- âœ… Controllerå±‚: `userProgressController.ts`
- âœ… Routeså±‚: `userProgress.ts`
- âœ… å·²æ³¨å†Œåˆ° `app.ts`

---

## ğŸš€ å¿«é€Ÿæµ‹è¯•

### å‰ææ¡ä»¶
- æœåŠ¡å™¨å·²å¯åŠ¨
- å·²ç™»å½•è·å–Token
- æ•°æ®åº“ä¸­æœ‰é¢˜åº“æ•°æ®

### æµ‹è¯•ç¯å¢ƒå˜é‡
```json
{
  "base_url": "http://localhost:3001",
  "token": "your_jwt_token",
  "bank_id": 2,
  "user_id": 1
}
```

---

## ğŸ“‹ æµ‹è¯•ç”¨ä¾‹

### 1. é¦–æ¬¡è¿›å…¥é¢˜åº“ï¼ˆè·å–è¿›åº¦ï¼‰

**è¯·æ±‚**:
```bash
GET http://localhost:3001/api/user-progress/2
Authorization: Bearer YOUR_TOKEN
```

**é¢„æœŸç»“æœ**: 
```json
{
  "code": 200,
  "message": "æš‚æ— å­¦ä¹ è¿›åº¦",
  "data": null
}
```

---

### 2. å¼€å§‹å­¦ä¹ ï¼ˆä¿å­˜è¿›åº¦ï¼‰

**è¯·æ±‚**:
```bash
POST http://localhost:3001/api/user-progress/2
Authorization: Bearer YOUR_TOKEN
Content-Type: application/json

{
  "parse_result_id": 5,
  "current_question_index": 1,
  "completed_count": 1,
  "total_questions": 50
}
```

**é¢„æœŸç»“æœ**:
```json
{
  "code": 200,
  "message": "ä¿å­˜å­¦ä¹ è¿›åº¦æˆåŠŸ",
  "data": {
    "id": 1,
    "user_id": 10,
    "bank_id": 2,
    "current_question_index": 1,
    "completed_count": 1,
    "total_questions": 50,
    "progress_percentage": 2
  }
}
```

---

### 3. ç»§ç»­å­¦ä¹ ï¼ˆæ›´æ–°è¿›åº¦ï¼‰

**è¯·æ±‚**:
```bash
POST http://localhost:3001/api/user-progress/2
Authorization: Bearer YOUR_TOKEN
Content-Type: application/json

{
  "current_question_index": 10,
  "completed_count": 10,
  "total_questions": 50
}
```

**é¢„æœŸç»“æœ**:
```json
{
  "code": 200,
  "message": "ä¿å­˜å­¦ä¹ è¿›åº¦æˆåŠŸ",
  "data": {
    "current_question_index": 10,
    "completed_count": 10,
    "total_questions": 50,
    "progress_percentage": 20
  }
}
```

---

### 4. å†æ¬¡è¿›å…¥é¢˜åº“ï¼ˆæ–­ç‚¹ç»­å­¦ï¼‰

**è¯·æ±‚**:
```bash
GET http://localhost:3001/api/user-progress/2
Authorization: Bearer YOUR_TOKEN
```

**é¢„æœŸç»“æœ**:
```json
{
  "code": 200,
  "message": "è·å–å­¦ä¹ è¿›åº¦æˆåŠŸ",
  "data": {
    "current_question_index": 10,
    "completed_count": 10,
    "total_questions": 50,
    "progress_percentage": 20
  }
}
```

---

### 5. æŸ¥çœ‹æ‰€æœ‰å­¦ä¹ è¿›åº¦

**è¯·æ±‚**:
```bash
GET http://localhost:3001/api/user-progress
Authorization: Bearer YOUR_TOKEN
```

**é¢„æœŸç»“æœ**:
```json
{
  "code": 200,
  "message": "è·å–æ‰€æœ‰å­¦ä¹ è¿›åº¦æˆåŠŸ",
  "data": [
    {
      "bank_id": 2,
      "current_question_index": 10,
      "progress_percentage": 20
    }
  ]
}
```

---

### 6. æŸ¥çœ‹æœ€è¿‘å­¦ä¹ çš„é¢˜åº“

**è¯·æ±‚**:
```bash
GET http://localhost:3001/api/user-progress/recent?limit=3
Authorization: Bearer YOUR_TOKEN
```

**é¢„æœŸç»“æœ**:
```json
{
  "code": 200,
  "message": "è·å–æœ€è¿‘å­¦ä¹ é¢˜åº“æˆåŠŸ",
  "data": [...]
}
```

---

### 7. é‡ç½®è¿›åº¦

**è¯·æ±‚**:
```bash
DELETE http://localhost:3001/api/user-progress/2
Authorization: Bearer YOUR_TOKEN
```

**é¢„æœŸç»“æœ**:
```json
{
  "code": 200,
  "message": "é‡ç½®å­¦ä¹ è¿›åº¦æˆåŠŸ",
  "data": null
}
```

---

## ğŸ§ª å®Œæ•´æµ‹è¯•æµç¨‹

### Postman/Apifox æµ‹è¯•æ­¥éª¤

1. **è®¾ç½®ç¯å¢ƒå˜é‡**
   - base_url: `http://localhost:3001`
   - token: ä»ç™»å½•æ¥å£è·å–
   - bank_id: ç°æœ‰é¢˜åº“ID

2. **æµ‹è¯•é¡ºåº**
   ```
   â‘  è·å–è¿›åº¦ï¼ˆåº”è¯¥ä¸ºç©ºï¼‰
   â‘¡ ä¿å­˜è¿›åº¦ï¼ˆindex=1ï¼‰
   â‘¢ è·å–è¿›åº¦ï¼ˆåº”è¯¥æ˜¾ç¤ºindex=1ï¼‰
   â‘£ æ›´æ–°è¿›åº¦ï¼ˆindex=10ï¼‰
   â‘¤ è·å–è¿›åº¦ï¼ˆåº”è¯¥æ˜¾ç¤ºindex=10ï¼‰
   â‘¥ æŸ¥çœ‹æ‰€æœ‰è¿›åº¦
   â‘¦ æŸ¥çœ‹æœ€è¿‘å­¦ä¹ 
   â‘§ é‡ç½®è¿›åº¦
   â‘¨ å†æ¬¡è·å–ï¼ˆåº”è¯¥ä¸ºç©ºï¼‰
   ```

---

## ğŸ’¡ å‰ç«¯é›†æˆç¤ºä¾‹

### Vue/React ç¤ºä¾‹

```javascript
// 1. è¿›å…¥é¢˜åº“é¡µé¢
async mounted() {
  const bankId = this.$route.params.id;
  
  // è·å–é¢˜åº“è§£æç»“æœ
  const parseResult = await this.getParseResult(bankId);
  this.questions = parseResult.questions;
  this.totalQuestions = parseResult.total_questions;
  
  // è·å–å­¦ä¹ è¿›åº¦
  const progress = await this.getUserProgress(bankId);
  
  if (progress) {
    // æœ‰è¿›åº¦ï¼Œè·³è½¬åˆ°ä¸Šæ¬¡ä½ç½®
    this.currentIndex = progress.current_question_index;
    this.completedCount = progress.completed_count;
    
    this.$message.success(`ç»§ç»­å­¦ä¹ ï¼Œè¿›åº¦: ${progress.progress_percentage}%`);
  } else {
    // æ— è¿›åº¦ï¼Œä»å¤´å¼€å§‹
    this.currentIndex = 0;
    this.completedCount = 0;
    
    this.$message.info('å¼€å§‹æ–°çš„å­¦ä¹ ');
  }
}

// 2. ç­”é¢˜åä¿å­˜è¿›åº¦
async onAnswerSubmit() {
  // ... éªŒè¯ç­”æ¡ˆé€»è¾‘
  
  // æ›´æ–°è¿›åº¦
  this.currentIndex++;
  this.completedCount++;
  
  // ä¿å­˜åˆ°æœåŠ¡å™¨
  await this.saveProgress(this.bankId, {
    current_question_index: this.currentIndex,
    completed_count: this.completedCount,
    total_questions: this.totalQuestions
  });
  
  // è·³è½¬ä¸‹ä¸€é¢˜æˆ–å®Œæˆ
  if (this.currentIndex < this.totalQuestions) {
    this.showNextQuestion();
  } else {
    this.showCompleteScreen();
  }
}

// 3. API æ–¹æ³•å°è£…
async getUserProgress(bankId) {
  const res = await axios.get(`/api/user-progress/${bankId}`);
  return res.data.data;
}

async saveProgress(bankId, data) {
  const res = await axios.post(`/api/user-progress/${bankId}`, data);
  return res.data.data;
}
```

### å¾®ä¿¡å°ç¨‹åºç¤ºä¾‹

```javascript
// è¿›å…¥é¢˜åº“é¡µé¢
onLoad(options) {
  const bankId = options.id;
  
  // è·å–è¿›åº¦
  wx.request({
    url: `${baseUrl}/api/user-progress/${bankId}`,
    header: {
      'Authorization': `Bearer ${wx.getStorageSync('token')}`
    },
    success: (res) => {
      if (res.data.data) {
        // æœ‰è¿›åº¦
        this.setData({
          currentIndex: res.data.data.current_question_index,
          progress: res.data.data.progress_percentage
        });
        
        wx.showToast({
          title: `ç»§ç»­å­¦ä¹  ${res.data.data.progress_percentage}%`,
          icon: 'none'
        });
      }
    }
  });
}

// ä¿å­˜è¿›åº¦
saveProgress() {
  wx.request({
    url: `${baseUrl}/api/user-progress/${this.data.bankId}`,
    method: 'POST',
    header: {
      'Authorization': `Bearer ${wx.getStorageSync('token')}`,
      'Content-Type': 'application/json'
    },
    data: {
      current_question_index: this.data.currentIndex,
      completed_count: this.data.completedCount,
      total_questions: this.data.totalQuestions
    }
  });
}
```

---

## âœ… éªŒè¯æ¸…å•

- [ ] æ•°æ®è¡¨å·²åˆ›å»ºï¼ˆæ£€æŸ¥æ•°æ®åº“ï¼‰
- [ ] é¦–æ¬¡è·å–è¿›åº¦è¿”å›null
- [ ] ä¿å­˜è¿›åº¦æˆåŠŸ
- [ ] å†æ¬¡è·å–æ˜¾ç¤ºæ­£ç¡®è¿›åº¦
- [ ] æ›´æ–°è¿›åº¦æˆåŠŸ
- [ ] è¿›åº¦ç™¾åˆ†æ¯”è®¡ç®—æ­£ç¡®
- [ ] æŸ¥çœ‹æ‰€æœ‰è¿›åº¦åˆ—è¡¨
- [ ] æŸ¥çœ‹æœ€è¿‘å­¦ä¹ é¢˜åº“
- [ ] é‡ç½®è¿›åº¦æˆåŠŸ
- [ ] å”¯ä¸€çº¦æŸç”Ÿæ•ˆï¼ˆåŒä¸€ç”¨æˆ·+é¢˜åº“åªæœ‰ä¸€æ¡è®°å½•ï¼‰

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜1: 404 Not Found
**åŸå› **: è·¯ç”±æœªæ³¨å†Œ  
**æ£€æŸ¥**: `app.ts` ä¸­æ˜¯å¦æœ‰ `app.use('/api/user-progress', userProgressRoutes)`

### é—®é¢˜2: 401 Unauthorized
**åŸå› **: Tokenæ— æ•ˆ  
**è§£å†³**: é‡æ–°ç™»å½•è·å–æ–°Token

### é—®é¢˜3: è¿›åº¦ä¸æ›´æ–°
**åŸå› **: å‚æ•°é”™è¯¯  
**æ£€æŸ¥**: ç¡®ä¿ä¼ é€’äº† `current_question_index` å’Œ `total_questions`

### é—®é¢˜4: æ•°æ®è¡¨ä¸å­˜åœ¨
**åŸå› **: æœåŠ¡å™¨æœªé‡å¯æˆ–æ•°æ®åº“è¿ç§»å¤±è´¥  
**è§£å†³**: é‡å¯æœåŠ¡å™¨ï¼Œæ£€æŸ¥æ—¥å¿—

---

## ğŸ“Š æ•°æ®åº“æ£€æŸ¥

```sql
-- æŸ¥çœ‹è¡¨ç»“æ„
DESC user_study_progress;

-- æŸ¥çœ‹æ‰€æœ‰è¿›åº¦è®°å½•
SELECT * FROM user_study_progress;

-- æŸ¥çœ‹æŸç”¨æˆ·çš„è¿›åº¦
SELECT * FROM user_study_progress WHERE user_id = 1;

-- æŸ¥çœ‹æŸé¢˜åº“çš„å­¦ä¹ äººæ•°
SELECT COUNT(*) FROM user_study_progress WHERE bank_id = 2;
```

---

**åˆ›å»ºæ—¶é—´**: 2025-10-26  
**åŠŸèƒ½çŠ¶æ€**: âœ… å·²å®Œæˆ  
**æµ‹è¯•çŠ¶æ€**: å¾…æµ‹è¯•

